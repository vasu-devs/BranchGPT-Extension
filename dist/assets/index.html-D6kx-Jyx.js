import{r as u,j as e,G as E,P as M,C as v,U as R,a as N,B as $,b as k,T as A,e as T,R as G}from"./user-C1cwYdab.js";import{g as L,a as O,c as D,m as H,d as F}from"./messages-Dgt2uc6m.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&l(p)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();function U(){const[o,d]=u.useState([]),[i,l]=u.useState(null),[n,a]=u.useState([]),[p,f]=u.useState(new Set);u.useEffect(()=>{chrome.storage.local.get(["activeBranchId"],t=>{t.activeBranchId&&l(t.activeBranchId)}),m(),chrome.runtime.onMessage.addListener(t=>{t.type==="REFRESH_BRANCHES"&&(m(),chrome.storage.local.get(["activeBranchId"],r=>{r.activeBranchId&&l(r.activeBranchId)}))})},[]),u.useEffect(()=>{i?(chrome.storage.local.set({activeBranchId:i}),z(i),y(i)):(a([]),chrome.storage.local.remove("activeBranchId"))},[i]);async function m(){const t=await L();d(t)}async function z(t){const r=await O(t);a(r)}function y(t){f(r=>{const c=new Set(r);let s=o.find(x=>x.id===t);for(;s&&s.parentBranchId;){c.add(s.parentBranchId);const x=s.parentBranchId;s=o.find(b=>b.id===x)}return c})}async function B(){const t=await D({label:"New Conversation"});m(),l(t.id)}async function w(t,r){t.stopPropagation(),await F(r),m(),i===r&&l(null)}async function I(t,r){if(t.stopPropagation(),!r.parentBranchId){alert("Cannot merge a root branch (no parent).");return}await H(r.id,r.parentBranchId),l(r.parentBranchId),alert("Merged successfully! Switched to parent branch.")}function S(t,r){t.stopPropagation(),f(c=>{const s=new Set(c);return s.has(r)?s.delete(r):s.add(r),s})}function C(t){const r=[];if(!t)return r;let c=o.find(s=>s.id===t);for(;c;)if(r.unshift(c),c.parentBranchId){const s=c.parentBranchId;c=o.find(x=>x.id===s)}else c=void 0;return r}function j(t=null,r=0){const c=o.filter(s=>s.parentBranchId===t);return c.length===0?null:e.jsx("div",{className:`flex flex-col ${r>0?"ml-3 border-l border-zinc-800":""}`,children:c.map(s=>{const x=o.some(h=>h.parentBranchId===s.id),b=p.has(s.id),P=i===s.id;return e.jsxs("div",{className:"relative",children:[e.jsx(q,{branch:s,isActive:P,hasChildren:x,isExpanded:b,onSelect:()=>l(s.id),onToggle:h=>S(h,s.id),onDelete:h=>w(h,s.id),onMerge:h=>I(h,s)}),x&&b&&j(s.id,r+1)]},s.id)})})}const g=C(i);return e.jsxs("div",{className:"w-full h-screen bg-[#09090b] text-zinc-100 font-sans flex flex-col",children:[e.jsxs("header",{className:"px-4 py-3 border-b border-zinc-800 flex items-center justify-between bg-[#09090b]/95 backdrop-blur z-10 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 bg-purple-500/10 rounded-md",children:e.jsx(E,{size:16,className:"text-purple-400"})}),e.jsx("span",{className:"font-semibold text-sm tracking-tight",children:"BranchGPT"})]}),e.jsx("button",{onClick:B,className:"p-1.5 hover:bg-zinc-800 rounded-md transition-colors text-zinc-400 hover:text-white",title:"New Root Branch",children:e.jsx(M,{size:16})})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-zinc-800 border-b border-zinc-800 min-h-[35%]",children:[e.jsxs("h3",{className:"text-[10px] uppercase font-bold text-zinc-500 mb-2 px-2 flex justify-between",children:[e.jsx("span",{children:"Graph"}),e.jsx("span",{className:"text-[9px] opacity-50",children:"Recursive"})]}),o.length===0?e.jsx("div",{className:"text-center text-zinc-500 py-8 text-xs",children:"No branches yet"}):j(null)]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 scrollbar-thin scrollbar-thumb-zinc-800 bg-zinc-900/30 flex flex-col",children:[e.jsx("div",{className:"sticky top-0 bg-[#09090b]/95 backdrop-blur z-10 border-b border-zinc-800/50 pb-2 mb-2",children:e.jsxs("div",{className:"flex items-center gap-1 overflow-x-auto scrollbar-none whitespace-nowrap px-1 pb-1",children:[e.jsx("span",{className:"text-[10px] text-zinc-600",children:"PATH:"}),g.length>0?g.map((t,r)=>e.jsxs("div",{className:"flex items-center",children:[r>0&&e.jsx(v,{size:8,className:"text-zinc-600 mx-0.5"}),e.jsx("button",{onClick:()=>l(t.id),className:`text-[10px] hover:text-purple-400 transition-colors ${r===g.length-1?"text-purple-300 font-medium":"text-zinc-500"}`,children:t.label})]},t.id)):e.jsx("span",{className:"text-[10px] text-zinc-700 italic",children:"None selected"})]})}),i?e.jsxs("div",{className:"space-y-4 p-2 pb-4",children:[n.map(t=>e.jsxs("div",{className:`flex gap-3 ${t.role==="user"?"flex-row-reverse":""}`,children:[e.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center shrink-0 ${t.role==="user"?"bg-zinc-700":t.role==="system"?"bg-blue-500/20 text-blue-400":"bg-green-600/20 text-green-400"}`,children:t.role==="user"?e.jsx(R,{size:10}):t.role==="system"?e.jsx(N,{size:10}):e.jsx($,{size:10})}),e.jsx("div",{className:`text-[11px] p-2 rounded-lg max-w-[90%] leading-relaxed ${t.role==="user"?"bg-zinc-800 text-zinc-200":t.role==="system"?"bg-blue-900/10 border border-blue-500/20 text-blue-300 italic":"bg-transparent border border-zinc-800 text-zinc-300"}`,children:t.content})]},t.id)),n.length===0&&e.jsx("div",{className:"text-center text-[10px] text-zinc-500 py-4",children:"No messages captured"})]}):e.jsx("div",{className:"flex items-center justify-center h-full text-zinc-600 text-[10px]",children:"Select a branch to view timeline"})]})]}),e.jsxs("div",{className:"p-1.5 border-t border-zinc-800 text-[10px] text-zinc-600 flex justify-between px-3",children:[e.jsxs("span",{children:["Nodes: ",o.length]}),e.jsx("span",{children:"DAG Mode"})]})]})}function q({branch:o,isActive:d,hasChildren:i,isExpanded:l,onSelect:n,onToggle:a,onDelete:p,onMerge:f}){return e.jsxs("div",{className:`
            group flex items-center gap-1.5 p-1.5 rounded-md cursor-pointer transition-all border 
            ${d?"bg-purple-500/10 border-purple-500/20":"border-transparent hover:bg-zinc-800/50"}
        `,children:[e.jsx("div",{className:`p-0.5 rounded hover:bg-zinc-700/50 text-zinc-500 ${i?"":"invisible"}`,onClick:a,children:l?e.jsx(k,{size:10}):e.jsx(v,{size:10})}),e.jsx("div",{className:"flex-1 min-w-0",onClick:n,children:e.jsx("div",{className:`text-xs font-medium truncate ${d?"text-purple-300":"text-zinc-300"}`,children:o.label})}),e.jsxs("div",{className:`flex items-center gap-1 ${d||"opacity-0 group-hover:opacity-100"} transition-opacity`,children:[e.jsx("button",{onClick:f,title:"Merge to Parent",className:"p-1 hover:bg-blue-500/20 text-zinc-500 hover:text-blue-400 rounded",children:e.jsx(N,{size:10})}),e.jsx("button",{onClick:p,title:"Prune",className:"p-1 hover:bg-red-500/20 text-zinc-500 hover:text-red-400 rounded",children:e.jsx(A,{size:10})})]})]})}T.createRoot(document.getElementById("root")).render(e.jsx(G.StrictMode,{children:e.jsx(U,{})}));
