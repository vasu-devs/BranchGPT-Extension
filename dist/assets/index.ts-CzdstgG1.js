import{g as h,a as g,c as i,d as y,m as u,b as s}from"./messages-Dgt2uc6m.js";chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});chrome.runtime.onMessage.addListener((e,l,a)=>{if(e.type==="FORK_BRANCH")B(e.payload);else{if(e.type==="PROXY_GET_ALL_BRANCHES")return h().then(a),!0;if(e.type==="PROXY_GET_MESSAGES")return g(e.payload.branchId).then(a),!0;if(e.type==="PROXY_CREATE_BRANCH")return i(e.payload).then(t=>{a(t),n()}),!0;if(e.type==="PROXY_DELETE_BRANCH")return y(e.payload.id).then(()=>{a(),n()}),!0;if(e.type==="PROXY_MERGE_BRANCH")return u(e.payload.sourceId,e.payload.targetId).then(t=>{a(t),n()}),!0}return!0});async function n(){chrome.runtime.sendMessage({type:"REFRESH_BRANCHES"}).catch(()=>{});const e=await chrome.tabs.query({active:!0,currentWindow:!0});e.length>0&&e[0].id&&chrome.tabs.sendMessage(e[0].id,{type:"REFRESH_BRANCHES"}).catch(()=>{})}async function B(e){var o;console.log("Forking w/ history size:",((o=e.fullHistory)==null?void 0:o.length)||0);const a=(await chrome.storage.local.get(["activeBranchId"])).activeBranchId||void 0,t=await i({label:e.content?`${e.content.slice(0,15)}...`:"Forked Branch",parentBranchId:a});if(await chrome.storage.local.set({activeBranchId:t.id}),e.fullHistory&&e.fullHistory.length>0){let c;for(const r of e.fullHistory){const d=r.role==="user"||r.role==="assistant"||r.role==="system"?r.role:"user";c=(await s({branchId:t.id,role:d,content:r.content,parentId:c})).id}}else await s({branchId:t.id,role:"system",content:"Fork created (no history captured)"});console.log("Created branch:",t.id),n()}
