import{g as d,a as g,c as i,d as u,m as f,b as s}from"./messages-Dgt2uc6m.js";chrome.sidePanel&&chrome.sidePanel.setPanelBehavior&&chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(console.error);chrome.runtime.onMessage.addListener((e,l,r)=>e.type==="FORK_BRANCH"?(y(e.payload).then(t=>r(t)).catch(t=>r({success:!1,error:t.message})),!0):e.type==="PROXY_GET_ALL_BRANCHES"?(d().then(r),!0):e.type==="PROXY_GET_MESSAGES"?(g(e.payload.branchId).then(r),!0):e.type==="PROXY_CREATE_BRANCH"?(i(e.payload).then(t=>{r(t),c()}),!0):e.type==="PROXY_DELETE_BRANCH"?(u(e.payload.id).then(()=>{r(),c()}),!0):(e.type==="PROXY_MERGE_BRANCH"&&f(e.payload.sourceId,e.payload.targetId).then(t=>{r(t),c()}),!0));async function c(){chrome.runtime.sendMessage({type:"REFRESH_BRANCHES"}).catch(()=>{});const e=await chrome.tabs.query({active:!0,currentWindow:!0});e.length>0&&e[0].id&&chrome.tabs.sendMessage(e[0].id,{type:"REFRESH_BRANCHES"}).catch(()=>{})}async function y(e){var n;console.log("Forking w/ history size:",((n=e.fullHistory)==null?void 0:n.length)||0);const r=(await chrome.storage.local.get(["activeBranchId"])).activeBranchId||void 0,t=await i({label:e.content?`${e.content.slice(0,15)}...`:"Forked Branch",parentBranchId:r});if(await chrome.storage.local.set({activeBranchId:t.id}),e.fullHistory&&e.fullHistory.length>0){let o;for(const a of e.fullHistory){const h=a.role==="user"||a.role==="assistant"||a.role==="system"?a.role:"user";o=(await s({branchId:t.id,role:h,content:a.content,parentId:o})).id}}else await s({branchId:t.id,role:"system",content:"Fork created (no history captured)"});return console.log("Created branch:",t.id),c(),{success:!0,branchId:t.id}}
