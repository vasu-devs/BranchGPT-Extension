import{c as l,b as c}from"./messages-Dgt2uc6m.js";chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});chrome.runtime.onMessage.addListener((e,i,s)=>(e.type==="FORK_BRANCH"&&h(e.payload),!0));async function h(e){var o;console.log("Forking w/ history size:",((o=e.fullHistory)==null?void 0:o.length)||0);const s=(await chrome.storage.local.get(["activeBranchId"])).activeBranchId||void 0,r=await l({label:e.content?`${e.content.slice(0,15)}...`:"Forked Branch",parentBranchId:s});if(await chrome.storage.local.set({activeBranchId:r.id}),e.fullHistory&&e.fullHistory.length>0){let a;for(const t of e.fullHistory){const d=t.role==="user"||t.role==="assistant"||t.role==="system"?t.role:"user";a=(await c({branchId:r.id,role:d,content:t.content,parentId:a})).id}}else await c({branchId:r.id,role:"system",content:"Fork created (no history captured)"});console.log("Created branch:",r.id),chrome.runtime.sendMessage({type:"REFRESH_BRANCHES"});const n=await chrome.tabs.query({active:!0,currentWindow:!0});n.length>0&&n[0].id&&chrome.tabs.sendMessage(n[0].id,{type:"REFRESH_BRANCHES"})}
