import{c as d,a}from"./messages-BZZOhQZB.js";chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0});chrome.runtime.onMessage.addListener((e,c,r)=>(e.type==="FORK_BRANCH"&&l(e.payload),!0));async function l(e){var o;console.log("Forking w/ history size:",((o=e.fullHistory)==null?void 0:o.length)||0);const r=(await chrome.storage.local.get(["activeBranchId"])).activeBranchId||void 0,n=await d({label:e.content?`${e.content.slice(0,15)}...`:"Forked Branch",parentBranchId:r});if(await chrome.storage.local.set({activeBranchId:n.id}),e.fullHistory&&e.fullHistory.length>0){let s;for(const t of e.fullHistory){const i=t.role==="user"||t.role==="assistant"||t.role==="system"?t.role:"user";s=(await a({branchId:n.id,role:i,content:t.content,parentId:s})).id}}else await a({branchId:n.id,role:"system",content:"Fork created (no history captured)"});console.log("Created branch:",n.id),chrome.runtime.sendMessage({type:"REFRESH_BRANCHES"})}
